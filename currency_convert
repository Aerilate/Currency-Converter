import argparse
import sys

EURO_SIGN = 'â‚¬'
USD_SIGN = 'USD'

def parseCSV(content):
    lines = content.split('\n')
    parsed = [ line.split(',') for line in lines if line]
    return parsed

def CSVtoString(content):
    print(content)
    formatted = [ ','.join(line) for line in content ]
    formatted = '\n'.join(formatted)
    return formatted

def convertCurrency(content, fieldNum, multiplier):
    for i in range(1, len(content)): # ignore header row
        price = float(content[i][fieldNum])
        price = price * multiplier
        content[i][fieldNum] = EURO_SIGN + ' %.2f' % price

def main():
    parser = argparse.ArgumentParser(description='Converts prices in a CSV to another currency.')
    parser.add_argument('--field', metavar='N', type=int,
                        help='Convert CSV field N')
    parser.add_argument('--multiplier', metavar='N', type=float,
                        help='Muliply currency value by N for the current conversion rate')
    parser.add_argument('-i', metavar='input', type=str,
                        help='Read from input file (or stdin)')
    parser.add_argument('-o', metavar='output', type=str,
                        help='Write to output file (or stdout)')

    args = parser.parse_args()
    inputFile = args.i
    outputFile = args.o
    fieldNum = args.field
    multiplier = args.multiplier

    if inputFile:
        file = open(inputFile, "r")
        content = file.read()
    else:
        content = ''
        for line in sys.stdin:
            content += line
    parsed = parseCSV(content)

    convertCurrency(parsed, fieldNum, multiplier)
    
    newContent = CSVtoString(parsed)
    if outputFile:
        f = open(outputFile, "w")
        f.write(newContent)
        f.close()
    else:
        print(newContent)


if __name__ == '__main__':
    main()
